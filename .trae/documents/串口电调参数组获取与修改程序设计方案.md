## 协议帧格式
- 帧组成：`[Preamble][ASCII Payload][Checksum]`
- Preamble：默认 `0xFC`（可配置）。
- ASCII Payload：以 `#` 开头、以 `;` 结束。例如写入 A 组：
  - ASCII：`#A0:14.00,A1:60.00,...,A19:115.00;`
  - HEX 示例：`FC 23 41 30 3A 31 34 2E 30 30 ... 3B CB 37`（`0x23` 为 `#`，`0x3B` 为 `;`）
- Checksum：默认 `CRC16(Modbus)` 小端（低字节在前）。上例尾部 `CB 37` 即两字节校验值（可根据设备实际协议替换为 `SUM8`/`None`）。
- 读取请求：`#READ:A;`（同样附带 Checksum）。返回载荷为 `#A0:...,A1:...,...,A19:...;`。
- 写入请求：载荷为整组 `A0..A19` 的键值对（两位小数，逗号分隔），设备返回 ACK 或回显帧（具体按设备实现）。

## 字段与数值规则
- 键名：固定 `A0..A19`（每组 20 个，可扩展）。
- 数值：十进制浮点，默认保留两位小数（如 `665.00`）。
- 组标识：目前使用 `A`，可扩展 `B/C...`。

## Excel 命名配置（可自行修改）
- 文件位置：`config/params.xlsx`
- Sheet 结构：按组划分，一组一个 Sheet（例如：`A组`）。
- 列定义：
  - `Key`：参数键（如 `A0`、`A1`...）
  - `Name`：显示/自定义名称（中文或英文）
  - `Unit`：单位（如 `V`、`ms`、`A`）
  - `Min`/`Max`：允许范围（用于校验）
  - `Precision`：小数位（默认 2）
  - `Default`：缺省值（用于初始化/复位）
  - `Description`：说明（可选）
- 示例（A组，前几项）：
  - `A0, 启动电压, V, 0, 60, 2, 14.00, 启动时电压`
  - `A1, 最大转速, rpm, 0, 60000, 2, 60.00, 电机最高转速`
  - `A2, 最大电流, A, 0, 1000, 2, 45.00, 允许峰值电流`
  - `...`
- 协议参数 Sheet（可选）：`Protocol`
  - 列：`Preamble(十六进制)`、`Checksum(枚举: CRC16_MODBUS/SUM8/NONE)`、`Baud(如 115200)`、`Parity(N/E/O)`、`StopBits(1/2)`、`Timeout(ms)`

## 程序功能概述（Python）
- 依赖：`pyserial`（串口）、`openpyxl`（Excel）。如需 CSV 可兼容 `csv`。
- 模块：`Usart_Para_FK.py`
  - `load_mapping(excel_path)`: 读取各组 Sheet，生成键→命名/校验映射。
  - `build_frame(group, values, protocol_cfg)`: 根据 `values(A0..A19)` 拼 ASCII 载荷并计算校验，返回完整字节帧。
  - `parse_frame(frame_bytes, protocol_cfg)`: 校验帧，解析为 `{A0:..., ..., A19:...}`。
  - `read_group(port, group)`: 发送 `#READ:group;` 请求，读取并解析返回。
  - `write_group(port, group, values)`: 按映射校验范围与精度，构建写入帧并发送，处理 ACK/回显。
- 串口参数：默认 `115200-8N1`，超时 `1000ms`（均可由 Excel 的 `Protocol` Sheet 配置）。
- 错误处理：
  - 帧校验失败、超时重试（如 3 次）。
  - 值越界/精度不符时报错并拒绝发送。
  - 缓冲区内乱序或噪声：按 `Preamble/#/;` 进行帧同步，丢弃无效数据。

## 输入输出示例
- 写入 A 组（ASCII）：`#A0:14.00,A1:60.00,...,A19:115.00;` → 加 `CRC16` 得完整帧。
- 读取 A 组：发送 `#READ:A;` → 设备返回 `#A0:...,A1:...,...,A19:...;` + 校验。
- 映射展示：程序将 `A0..A19` 转为 Excel 中的 `Name` 与 `Unit` 展示，同时使用 `Min/Max/Precision` 校验。

## 验证与测试
- 本地构造若干合法/不合法帧做单元测试（校验通过/失败、越界、噪声）。
- 回环口或虚拟串口测试读写函数的稳定性与边界情况。

## 确认后实施
- 创建 `config/params.xlsx` 模板与 `Usart_Para_FK.py` 基础实现。
- 提供示例脚本：读取→打印映射名与值；修改若干值→写入→再次读取校验。
- 若设备的校验算法/ACK 机制与默认不同，按您提供的细节调整 `Protocol` Sheet 与实现。