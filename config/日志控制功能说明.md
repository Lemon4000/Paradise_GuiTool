# 日志控制功能说明

## 功能概述

在固件烧录标签页中新增了"启用日志输出"复选框，可以实时控制是否显示烧录过程中的详细日志信息。

## 使用方法

### 1. 通过UI复选框控制（实时生效）

在固件烧录标签页的控制区域，可以看到"启用日志输出"复选框：

- **勾选**：显示所有烧录日志，包括：
  - 发送/接收的帧数据（HEX格式和ASCII预览）
  - 状态日志消息
  - 错误详情（CRC校验失败、数据不匹配等）
  - 进度信息

- **取消勾选**：隐藏所有烧录日志输出
  - 仅保留关键的状态信息（如成功/失败）
  - 不显示帧数据的HEX dump
  - 减少界面刷新，提升性能

### 2. 默认状态配置

默认启用状态可以在 `config/config.py` 中设置：

```python
# 日志输出控制
ENABLE_LOGGING = False  # False=默认禁用，True=默认启用
```

程序启动时，复选框会自动设置为此默认值。

## 适用场景

### 禁用日志的场景：
- 批量烧录固件，不需要查看详细过程
- 提升烧录性能，减少UI刷新开销
- 界面保持简洁，只关注最终结果

### 启用日志的场景：
- 调试烧录问题，需要查看详细的通信帧
- 分析CRC校验失败的原因
- 学习了解烧录协议的工作流程

## 技术细节

### 控制范围

日志开关控制以下输出：

1. **FlashWorker 状态日志**
   - 通过 `_emit_log()` 方法控制
   - 包括各阶段状态转换、错误统计等

2. **帧数据显示**
   - `on_frame_sent()` - 发送帧的HEX dump
   - `on_frame_recv()` - 接收帧的HEX dump
   - 包括时间戳、长度、CRC值等元数据

3. **ASCII预览**
   - 帧数据的ASCII可读预览
   - HEX头部摘要信息

### 不受控制的输出

以下输出不受此开关影响，始终显示：

- 进度条更新（百分比）
- 烧录完成/失败的最终状态
- 系统级错误提示（如文件打开失败）

### 实时性

- 复选框状态改变时**立即生效**
- 可以在烧录过程中随时切换
- 切换日志开关时会在状态日志中记录提示

## 性能影响

禁用日志输出可以带来以下性能提升：

- 减少大量HTML格式化操作
- 降低QTextEdit控件的刷新频率
- 减少字符串拼接和内存分配
- 特别是在高速烧录时（2Mbps波特率）效果明显

## 注意事项

1. **调试模式兼容性**：调试模式（手动步进）仍然可以正常工作，日志开关不影响调试功能

2. **错误信息**：即使禁用日志，关键错误信息仍会通过弹窗或状态栏提示

3. **历史日志**：切换日志开关不会清除已经显示的历史日志内容

4. **配置持久化**：复选框状态目前不会保存到配置文件，每次启动使用默认值

## 快捷键（未来可扩展）

可以考虑为日志开关添加快捷键，例如：
- `Ctrl+L` - 切换日志显示
- `Ctrl+Shift+L` - 清空日志窗口

---

*最后更新：2025年*
